# docker-compose.prod.yml
version: "3.8"
services:
  osrm:
    image: osrm/osrm-backend:latest
    container_name: osrm
    volumes:
      - ./osrm:/data
    command: ["osrm-routed", "--algorithm", "mld", "/data/new-york-250917.osrm"]
    ports:
      - "5000:5000"

  flask:
    image: ${FLASK_IMAGE}
    container_name: nyc-flask
    volumes:
      - ./artifacts:/app/artifacts
    ports:
      - "8000:8000"
    environment:
      - FLASK_ENV=production
      - OSRM_BASE=http://osrm:5000/route/v1/driving
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=${AWS_REGION}